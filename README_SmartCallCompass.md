# Документация проекта "Smart Call Compass"

## Содержание
- [Общее описание системы](#общее-описание-системы)
- [Структура проекта](#структура-проекта)
- [Схема взаимодействия компонентов](#схема-взаимодействия-компонентов)
- [Фронтенд](#фронтенд)
  - [Основные файлы и папки](#основные-файлы-и-папки-фронтенд)
  - [Ключевые компоненты](#ключевые-компоненты-фронтенда)
- [Бэкенд](#бэкенд)
  - [Основные файлы и папки](#основные-файлы-и-папки-бэкенд)
  - [Ключевые модули](#ключевые-модули-бэкенда)
- [Взаимодействие между компонентами](#взаимодействие-между-компонентами)
- [Зависимости](#зависимости)
  - [Frontend (package.json)](#frontend-packagejson)
  - [Backend (requirements.txt)](#backend-requirementstxt)
- [Инструкция по развертыванию](#инструкция-по-развертыванию)
  - [Установка бэкенда](#установка-бэкенда)
  - [Установка фронтенда](#установка-фронтенда)
- [Настройка переменных окружения](#настройка-переменных-окружения)
  - [Бэкенд (.env)](#бэкенд-env)
  - [Фронтенд (.env.local)](#фронтенд-envlocal)
- [Ключевые функции системы](#ключевые-функции-системы)
- [Заключение](#заключение)

## Общее описание системы

"Smart Call Compass" - это комплексная система для анализа телефонных звонков, которая позволяет загружать записи звонков, получать их транскрипции, проводить детальный анализ с помощью искусственного интеллекта и визуализировать результаты в удобном интерфейсе. Система предназначена для улучшения работы контактных центров и отделов продаж.

## Структура проекта

Проект разделен на две основные части:
- **Фронтенд**: интерфейс пользователя на React.js с использованием TypeScript, расположенный в папке `smart-call-compass`
- **Бэкенд**: серверная часть на Python с использованием Flask, расположенная в корневой директории проекта

## Схема взаимодействия компонентов

```
                      +-------------------+
                      |                   |
                      |  Браузер клиента  |
                      |                   |
                      +--------+----------+
                               |
                               | HTTP/HTTPS
                               |
                     +---------v---------+
                     |                   |
                     |  Frontend (React) |
                     |                   |
                     +---------+---------+
                               |
                               | API-запросы
                               |
+----------------+   +---------v---------+   +----------------+
|                |   |                   |   |                |
| Загрузка файлов|<->|  Backend (Flask)  |<->| Excel файлы    |
|                |   |                   |   | (хранилище)    |
+----------------+   +---------+---------+   +----------------+
                               |
                               | API-запросы
                               |
                     +---------v---------+
                     |                   |
                     | AI-сервисы (LLM)  |
                     | для анализа       |
                     +---------+---------+
                               |
                     +---------v---------+
                     |                   |
                     | Сервис транскрипции|
                     |                   |
                     +-------------------+
```

## Фронтенд

Фронтенд построен на React.js с использованием TypeScript и Vite, организован по принципу компонентного подхода.

### Основные файлы и папки (фронтенд)

```
smart-call-compass/
├── src/
│   ├── components/       # Компоненты интерфейса
│   │   ├── calls/        # Компоненты для работы со звонками
│   │   │   ├── CallsTable.tsx         # Таблица звонков
│   │   │   ├── CallDetails.tsx        # Детальная информация о звонке
│   │   │   ├── CallsComparison.tsx    # Сравнение звонков
│   │   │   └── AlertsSystem.tsx       # Система оповещений
│   │   ├── analysis/     # Компоненты для анализа
│   │   │   ├── PreviewAnalysis.tsx    # Предварительный анализ
│   │   │   ├── AnalyticsChat.tsx      # Чат для анализа
│   │   │   └── CustomPromptAnalysis.tsx # Анализ с пользовательским запросом
│   │   ├── dashboard/    # Компоненты для дашборда
│   │   │   ├── AnalyticsChart.tsx     # Графики и диаграммы
│   │   │   ├── StatCard.tsx           # Карточки со статистикой
│   │   │   ├── IssuesTable.tsx        # Таблица проблем
│   │   │   ├── TrainingRecommendations.tsx # Рекомендации по обучению
│   │   │   └── ChatAnalytics.tsx      # Чат для аналитики
│   │   ├── layout/       # Компоненты для макета
│   │   └── ui/           # UI-компоненты (кнопки, формы и т.д.)
│   ├── pages/            # Страницы приложения
│   │   ├── Index.tsx     # Главная страница
│   │   ├── Calls.tsx     # Страница со звонками
│   │   ├── Dashboard.tsx # Дашборд с аналитикой
│   │   ├── ChatAnalytics.tsx # Страница чат-аналитики
│   │   └── NotFound.tsx  # Страница 404
│   ├── lib/              # Вспомогательные функции и утилиты
│   ├── hooks/            # React хуки
│   ├── contexts/         # Контексты React
│   ├── App.tsx           # Основной компонент приложения
│   └── main.tsx          # Точка входа
├── public/               # Статические файлы
├── index.html            # Основной HTML файл
├── vite.config.ts        # Конфигурация Vite
└── package.json          # Зависимости проекта
```

### Ключевые компоненты фронтенда

1. **CallsTable.tsx**  
   Таблица для отображения списка звонков с возможностью сортировки, фильтрации и выбора звонков для анализа. Поддерживает экспорт данных в CSV.

2. **Dashboard.tsx**  
   Главный компонент дашборда, который собирает и отображает различные элементы аналитики: графики, статистику, карточки с информацией.

3. **PreviewAnalysis.tsx**  
   Компонент для предварительного анализа звонков с определением ключевых вопросов и рекомендаций.

4. **ChatAnalytics.tsx**  
   Интерфейс чата для взаимодействия с аналитическими данными через естественный язык.

5. **CustomPromptAnalysis.tsx**  
   Компонент для анализа звонков с использованием пользовательских запросов.

## Бэкенд

Бэкенд реализован на Python с использованием Flask и обеспечивает API для взаимодействия с фронтендом. Хранение данных осуществляется в Excel-файлах.

### Основные файлы и папки (бэкенд)

```
./
├── api.py                # Основной файл API Flask и точка входа
├── main.py               # Модуль для транскрипции аудио
├── time_stamp.py         # Обработка временных меток
├── clean.py              # Очистка данных
├── process_table.py      # Обработка таблиц
├── uploads/              # Папка для загруженных файлов
├── requirements.txt      # Зависимости Python
└── DFASDF.xlsx           # Основной файл с данными звонков
```

### Ключевые модули бэкенда

1. **api.py**  
   Основной файл API, определяющий все доступные эндпоинты для взаимодействия с фронтендом и запуск сервера.  
   **Основные эндпоинты:**
   - `/api/calls` - получение списка звонков
   - `/api/upload` - загрузка Excel-файлов со звонками
   - `/api/transcribe` - транскрипция аудиофайлов
   - `/api/analyze` - анализ звонков
   - `/api/preview-analyze` - предварительный анализ
   - `/api/chat` - эндпоинт для взаимодействия с чатом аналитики
   - `/api/custom-analyze` - анализ с пользовательским запросом

2. **main.py**  
   Модуль для транскрипции аудиозаписей звонков.

3. **clean.py**  
   Скрипт для очистки и подготовки данных.

4. **process_table.py**  
   Обработка данных в таблицах Excel.

5. **time_stamp.py**  
   Работа с временными метками звонков.

## Взаимодействие между компонентами

### Загрузка звонков:
1. Пользователь загружает Excel-файл со звонками через Calls.tsx
2. Файл отправляется на бэкенд через API-запрос к `/api/upload`
3. api.py сохраняет файл, делает резервную копию текущего DFASDF.xlsx
4. Информация о файле отображается пользователю

### Транскрипция:
1. Пользователь выбирает звонки для транскрипции в Calls.tsx
2. Запрос на транскрипцию отправляется через API к `/api/transcribe`
3. api.py вызывает функцию batch_transcribe из main.py
4. Результат сохраняется в Excel и возвращается на фронтенд

### Анализ звонков:
1. Пользователь выбирает звонки для анализа в `CallsTable.tsx`
2. Запрос на анализ отправляется через API к `/api/analyze` или `/api/custom-analyze`
3. api.py анализирует транскрипции с помощью LLM-сервисов (Gemini, Groq)
4. Результаты анализа возвращаются на фронтенд

### Отображение дашборда:
1. `Dashboard.tsx` запрашивает данные о звонках через API
2. Данные визуализируются с помощью компонентов из папки `dashboard/`

### Чат-аналитика:
1. Пользователь вводит вопрос в `ChatAnalytics.tsx`
2. Запрос отправляется на бэкенд через API к `/api/chat`
3. api.py обрабатывает запрос с учетом данных о звонках
4. Ответ возвращается на фронтенд и отображается в чате

## Зависимости

### Frontend (package.json)

```json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-tabs": "^1.1.0",
    "@tanstack/react-query": "^5.56.2",
    "axios": "^1.9.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^3.6.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "tailwind-merge": "^2.5.2",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "typescript": "^5.5.3",
    "vite": "^5.4.1"
  }
}
```

### Backend (requirements.txt)

```
aiohttp==3.11.18
groq==0.24.0
python-dotenv==1.1.0
openpyxl==3.1.5
pandas==2.2.3
mutagen==1.47.0
```

## Инструкция по развертыванию

### Установка бэкенда

```bash
# Клонировать репозиторий
git clone https://github.com/your-repo/smart-call-compass.git
cd smart-call-compass

# Создать виртуальное окружение Python
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate или .\venv\Scripts\Activate.ps1

# Установить зависимости
pip install -r requirements.txt

# Настроить переменные окружения
cp .env.example .env
# Отредактировать .env файл с вашими API ключами и настройками

# Запустить сервер
python api.py
```

### Установка фронтенда

```bash
# Перейти в папку фронтенда
cd smart-call-compass

# Установить зависимости
npm install

# Запустить в режиме разработки
npm run dev

# Или собрать для продакшена
npm run build
npm run preview
```

## Настройка переменных окружения

### Бэкенд (.env)

```
# API ключи для сервисов
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key

# Настройки сервера
PORT=5000
DEBUG=True
ALLOWED_ORIGINS=http://localhost:3000

# Настройки базы данных
DATABASE_URL=sqlite:///app.db
# Или для MongoDB
MONGO_URI=mongodb://localhost:27017/smart_call_compass

# Настройки хранилища файлов
UPLOAD_FOLDER=./uploads
MAX_CONTENT_LENGTH=100485760  # 100 MB
```

### Фронтенд (.env.local)

```
# API URL
NEXT_PUBLIC_API_URL=http://localhost:5000/api

# Настройки приложения
NEXT_PUBLIC_APP_NAME=Smart Call Compass
NEXT_PUBLIC_MAX_UPLOAD_SIZE=100  # MB
```

## Ключевые функции системы

### Загрузка и обработка звонков:
- Загрузка Excel-файлов со ссылками на звонки
- Транскрибация аудиозаписей звонков
- Поддержка различных форматов аудио (MP3, WAV, OGG)

### Транскрипция:
- Высокоточное распознавание русской речи
- Пакетная обработка звонков
- Сохранение транскрипций в Excel-файл

### Анализ звонков:
- Определение ключевых моментов звонка
- Оценка качества работы менеджера
- Выявление проблем и успешных практик
- Анализ эмоционального состояния клиента
- Пользовательские запросы для анализа

### Аналитика:
- Динамика звонков по времени
- Сравнение эффективности менеджеров
- Выявление общих тенденций
- Таблица проблем и факторов успеха

### Экспорт данных:
- Выгрузка в CSV с настраиваемыми столбцами
- Сохранение результатов анализа

### Чат-интерфейс:
- Взаимодействие с данными через естественный язык
- Возможность задавать произвольные вопросы по звонкам

## Заключение

"Smart Call Compass" - это комплексное решение для анализа телефонных звонков, которое помогает повысить эффективность работы контактного центра и отдела продаж. Система сочетает в себе современные технологии распознавания речи и искусственного интеллекта для извлечения ценных инсайтов из звонков.

Модульная архитектура обеспечивает гибкость и расширяемость системы, позволяя легко добавлять новые функции и интеграции. Фронтенд на React с Vite предоставляет современный и удобный интерфейс, а бэкенд на Flask обеспечивает надежную обработку данных и взаимодействие с AI-сервисами.