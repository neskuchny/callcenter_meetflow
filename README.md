# О проекте

Этот проект предназначен для автоматизации обработки аудиозаписей, ссылки на которые хранятся в Excel-таблицах. Он включает в себя модули для транскрипции аудио (Groq API), подсчёта длительности записей, анализа статистик и очистки исходных данных.

---

## Структура и модули

### 1. `main.py`
- Основной скрипт для транскрипции аудио по URL-адресам.
- Использует асинхронные вызовы (`aiohttp`, `asyncio`) для загрузки и Groq (Whisper) для расшифровки.
- Принимает:
  - список URL в аргументах командной строки,
  - или файл с URL через флаг `-f / --file`.
- Пример запуска:
  ```bash
  python main.py -f urls.txt
  # или
  python main.py https://example.com/1.mp3 https://example.com/2.mp3
  ```
- Выводит текст транскрипций в консоль.

### 2. `process_table.py`
- Упрощённая версия `main.py` для быстрого тестирования.
- Предопределённый список URL внутри кода.
- Выводит результаты транскрипции в консоль.
- Используется для демонстрации или отладки без Excel.

### 3. `process_table_batch.py`
- Пакетная обработка Excel-файлов.
- Читает указанный файл (по умолчанию `DFASDF.xlsx`),
- Ищет строки, где в столбце E стоит «-» и есть URL в столбце F,
- Делит их на группы (константа `BATCH_SIZE`, по умолчанию 100),
- Вызывает `batch_transcribe` (из `main.py`), записывает полученный текст в столбец E и ставит метку `groq` в столбец G.
- Сохраняет промежуточные результаты после каждой группы и делает паузу `PAUSE_SECONDS`.
- Пример запуска:
  ```bash
  python process_table_batch.py path/to/DFASDF.xlsx
  ```

### 4. `clean.py`
- Два вспомогательных метода для очистки Excel-файлов:
  1. `clean_excel_file(filename)`: для каждой строки проверяет столбцы E и G, ставит «-» в E, если G пустой.
  2. `remove_dash_rows(filename)`: удаляет из файла строки, где в E стоит «-».
- Используется для подготовки («прописи») и фильтрации данных перед основной обработкой.
- Пример запуска (по умолчанию удаляет из `DFASDF_clean.xlsx`):
  ```bash
  python clean.py
  ```

### 5. `time_stamp.py`
- Асинхронный подсчёт длительности аудио.
- Читает Excel `DFASDF.xlsx`, берёт URL из столбца «Ссылка на запись», определяет длину каждого файла через `mutagen`.
- Записывает результат в новый столбец (например, `lanth`) и сохраняет промежуточно в `DFASDF_updated.xlsx`.
- Выводит длительность каждого батча и общую статистику.
- Запуск:
  ```bash
  python time_stamp.py
  ```

### 6. `time_calc.py`
- Анализ текстового файла с временными метками (`time_stamp.txt`).
- Формат mm.ss преобразуется в секунды, рассчитываются:
  - среднее, медиана, минимум, максимум, сумма,
  - общее число записей.
- Результат выводится в консоль.
- Запуск:
  ```bash
  python time_calc.py
  ```

---

## Взаимодействие и советы по использованию

1. **Подготовка данных**:
   - При первом запуске Excel-файлов рекомендуется запустить `clean.py`:
     ```bash
     python clean.py DFASDF.xlsx
     ```
   - Получится `DFASDF_without_dash.xlsx` без «пустых» строк.

2. **Транскрипция**:
   - Для единичных или небольших списков URL используйте `main.py`.
   - Для обработки большого Excel-файла используйте `process_table_batch.py`.
   - При тестах или демонстрациях можно задействовать `process_table.py`.

3. **Подсчёт длительности**:
   - Запустите `time_stamp.py` после транскрипции, чтобы добавить колонку длительностей в Excel.

4. **Статистический анализ**:
   - После генерации `time_stamp.txt` примените `time_calc.py` для получения отчёта по временам.

5. **Обновление и промежуточное сохранение**:
   - Скрипты `process_table_batch.py` и `time_stamp.py` сохраняют результаты по ходу обработки, поэтому можете прерывать и продолжать.

6. **Требования**:
   - Установить зависимости из `requirements.txt`:
     ```bash
     pip install -r requirements.txt
     ```

---

## Универсальные решения для переиспользования

- Асинхронная функция `download_audio` для неблокирующей загрузки файлов.
- Универсальная функция `batch_transcribe` для пакетных запросов к API.
- Модуль `clean_excel_file` и `remove_dash_rows` для очистки и фильтрации Excel-таблиц.
- Утилиты `convert_to_seconds` и `convert_to_mmss` для анализа временных меток.
- Функции из `time_stamp.py` для получения длительности аудио через Mutagen.
- Шаблон использования `.env` и `python-dotenv` для управления конфигурацией.
- Настройка логирования через стандартный модуль `logging` вместо `print`.
- Рекомендуемая структура проекта: CLI (в `main.py`), утилиты (отдельные скрипты), пакетная обработка (в `process_table_batch.py`).
- Примерная шаблонная структура и подход для быстрого старта в других проектах.

---

README.md создан для быстрого старта и понимания последовательности работы модулей проекта. 